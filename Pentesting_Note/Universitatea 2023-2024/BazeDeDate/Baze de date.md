# SQL 
## SELECT(DML)
```sql
select * from <tables>;
```

```sql
select name, appearances from supeheroes;
```

```sql
select name as hero_name, appearance from superheroes;
```

```sql
select distinct(hair) from superheroes;
```

```sql 
select distinct(hair) from superheroes limit 10;
```

## WHERE
![[Pasted image 20240115192944.png]]
```sql
select * from superheroes where gender = 'Female Characters'
```

```sql
select * from superheroes where year between 2000 and 2005;
```

```sql
select * from superheroes where hair in ('Strawberry Blond Hair','Red Hair', 'Auburn Hair');
```
![[Pasted image 20240115193302.png]]
```sql
select * from superheroes where hair like '%Blond%';
```

```sql
select * from superheroes where gender = 'Female Characters' AND align = 'Bad Characters';
```

```sql
select * from superheroes where hair = 'Red Hair' or hair = 'Strowberry Blond Hair' or hair = 'Auburn Hair';
```

```sql
select * from superheroes where hair not in ('Blond Hair','Black Hair', 'Brown Hair', 'Red Heir');
```

## ORDER BY
```sql
select * from superheroes order by year;
```
![[Pasted image 20240115194552.png]]
```sql
select * from superheroes order by appearances desc;
```

```sql
select * from superheroes where align = 'Bad Characters' order by appearances desc;
```

```sql
select * from superheroes where align ='Bad Characters' and gender = 'Female Characters'  order by appearances desc limit 5;
```

```sql
select * from superheroes order by year, appearances;
```

## Create TABLE
```sql
create table superheroes(
	id INT SERIAL PRIMARY KEY,
	name VARCHAR(100),
	align VARCHAR(30),
	eye VARCHAR(30),
	hair VARCHAR(30),
	gender VARCHAR(30),
	appearance INT,
	year INT,
	universe VARCHAR(10)
)
```
![[Pasted image 20240115200059.png]]
#### Delete TABLE
```sql
drop table superheroes;
```
## Change TABEL (DDL)
![[Pasted image 20240115202405.png]]
```sql 
alter table superheroes add column alive boolean;
```

```sql
alter table superheroes add column first_appearance timestamp;
```

```sql
alter table superheroes drop column year;
```

```sql
alter table superheroes drop column year;
```

```sql
alter table superheroes rename column name to hero_name;
```

```sql
alter table superheroes rename to hero_name;
```

```sql 
alter table superheroes tename to comic_characters; #schimba toata tabelul rename=)
```

# INSERT 
```sql
insert into superheroes (name, appearances, universe) values ('Spider-Man', 4043,'marvel')
```
# UPDATE
```sql
update superheroes set name='Batman', universe='dc' where id=1;
```

```sql
update superheroes set gender='Man', where gender='Male Characters';
```
# DELETE 
```sql
delete from superheroes where id=2;
```

```sql
delete from superheroes;
```

# Functie agrigate
```sql
select align, count(*) from superheroes group by align;
```
#### Cele mai populare functile agrigate
![[Pasted image 20240115211039.png]]

```sql
select align, count(*), sum(appearances) from superheroes group by align;
```

```sql
select align, avg(appearances), sum(appearances)/count(*) as average from superheroes group by align;
```

```sql
select year, min(appearances), max(appearances) from superheroes group by year;
```

```sql 
select year, min(appearances), max(appearances) as max_ap from superheroes group by year order by ma  
x_ap desc ;
```

# Grupare
```sql
select hair, count(*) as count from superheroes where gender='Female Characters' group by hair order  
by count desc limit 5;
```

```sql
select hair, count(*) from superheroes where gender='Female Characters' group by hair having count(*  
) > 10;
```

![[Pasted image 20240115213831.png]]
# Decompozitia datelor
### Legaturi dintre tabeluri
![[Pasted image 20240115214256.png]]

![[Pasted image 20240115214440.png]]

![[Pasted image 20240115215642.png]]

# SELECT din mai multe tabeluri (JOIN)
```sql
select products.name, product_types.type_name from products join product_types on products.type_id =  
product_types.id;
```

```sql
select products.name,products.price, products.type_id, product_types.type_name from products join product_types on products.type_id = product_types.id;
```

```sql
select p.name as product_name, t.type_name as product_type, p.price as product_price from products a  
s p join product_types as t on p.type_id = t.id where t.type_name = 'Вебинар' and p.price = 0;
```

![[Pasted image 20240115221418.png]]
# Tipuri de (JOIN)

```sql
select products.name, product_types.type_name from products left outer join product_types on product  
s.type_id = product_types.id;
```

```sql
select products.name, product_types.type_name from products right outer join product_types on produc  
ts.type_id = product_types.id;
```

```sql
select products.name, product_types.type_name from products full outer join product_types on product  
s.type_id = product_types.id;
```

```sql
select products.name, product_types.type_name from products cross join product_types;    #foarte rar
```
![[Pasted image 20240115223146.png]]
# Schema bazei de date

![[Pasted image 20240115223356.png]]

```sql
select p.id, p.name, p.price, s.quantity, p.price * s.quantity as total from products as p join sales as s on p.id = s.product_id where s.order_id=2;
```

```sql
select p.id, p.name, p.price, s.quantity, p.price * s.quantity as total from products as p join sale  
s as s on p.id = s.product_id join orders as o on o.id = s.order_id where o.customer_id=1;
```
![[Pasted image 20240115225104.png]]
# Sub cereri
```sql
select id, name, price from products where price = (select max(price) from products);
```

```sql
select id, name, price from products where id in (select product_id from sales);
```
![[Pasted image 20240115234147.png]]

# Transaction

```sql 
start transaction;
update accounts set balance = balance -15000 where account_number 1234567;
update accounts set balance = balance +15000 where account_number 7654321;
commit; # or rollback pentru a intoarce la datele initiale
```

# Index
```sql 
create index superheroes_name_idx on superheroes(name);
```

```sql
create index superheroes_appearances_idx on superheroes(appearances desc);
```

```sql 
create index pesona_name_idx on person(last_name, first_name)
```

```sql 
drop index peson_name_idx;
```

# Constrangeri
#### Primary key
```sql
create table superheroes(
id int primary key,
...
)
```
#### Not null
```sql
create table supeheroes(
...
name varchar(100) not null,
...
)
```
#### Unique
```sql
create table supeheroes(
...
name varchar(100) unique,
...
)
```
#### Check 
```sql
create table products(
...
price int check (price >= 0)
...
)
```
#### References
```sql
create table products(
...
type_id int references product_types(id)
...
)
```
![[Pasted image 20240116001135.png]]

# DDL
- `create`
- `drop`
- `alter`
- `truncate`
- `rename`
# DML
- `delete`
- `select`
- `insert`
- `upade`
# DCL
- `grant`
- `revoke`

In cazul in care se fac controale la fisierele incarcate sunt 2 posibilitati dea controla fisierele:
- partea de client - este javascript care se executa pe partea de client si care poate fii vazut de client nu este sigur
- partea de server - se executa ca de obicei pe limbajul pe care este scris backendul [[PHP]], [[C#]], [[Node.js]], [[python]]. Din punct de vedere de securitate este mai bun deoarece nu putem vedea codul sursa.
Sunt mai multe tipuri de filtrari:
- dupa extensie - in windows tipul de fisier este detectat dupa extensia acestuea lucreaza cu liste negre sau albe. Un control cunoscut este [[MIME]](Multipurpose Internet Mail Extension) care lucra in posta ca sa verifice tipul fisierului acum lucreaza si pe [[HTTP]](s). Acesta adauga in query un camp `Content-Type:image/jpeg` care si verifica daca fisierul este o imagine sau nu. 
- Magic Number validation - verifica signatura la fisierul transmis. La fel cum in [[Unix]] sunt definite extensile pentru fisiere. 
- Filtrarea dupa dimensiune la fisier - uneori serverul nu va permite sa incarcam fisiere mari deoarece putem sa acupam toate resursele acestuea. In cazul cand incarcam un shell acesta nu cred ca o sa fii o problema deoarece shell-ul nostru are `5.4 Kb`. 
- Filtrarea dupa denumirea de fisier - serverul nostru trebuie sa stocheze fisierele cu denumiri unici de aceea fiecarui fisier i se adauga sinboluri `random` sau se verifica daca este deja un fisier cu asa denumire si returneaza o erroare la user. La fel se verifica sa nu contina simboluri pericoloare `;` sau [[Poison Null Byte]] sau alte caractere din [[ASCII]].
- Filtrarea dupa continut - sistemele mai noi pot verificat continutul fisierului ca sa asigure ca nu se va schimba extensia acestuea(HZ CUM).
In versiunele mai vechi de [[PHP]] este posibil adaugarea [[Poison Null Byte]] si pe uram de incicat extensia. Sau de adaugat la campul de metadate(exif-data) la imagine codul malintions [[PHP]] care si pe urma la executat. 
------------------------------------------------------

### Client Side filtre
Putem sa transmite direct fisierul cu [[curl]] spre pagina de upload ca sa treaca filtrarea:
```bash
curl -X POST -F "submit:<value>" -F "<file-parameter>:@<path-to-file>" <site>
```

Filtrarea pe parte de client este posibila de realizat cu [[Burp Suite]] de a prinde cererile si de le modificat. 

### Server Side filtre
In depedenta de filtrul pe server dar vom avea nevoie sa facem ceva teste ca sa verificam cum acesta lucreaza.
- o metoda este de adaugat la urma fisierului o extensie: `image.jpeg.php` filtrul va verifica doar prima parte aceste si va crede ca este o imagine
- o extensie mai extra un exemplu daca este blocat `php` putem folosi `php3-7`, `phps`, `php-s`, `pht`, `phar`. 

### Magic numbers filtre
Pe partea de server se verifica byturile la fisier putem sa le schimbam cu [[hexeditor]] pentru a arata ca un fisier este de al tip.

Avem o metoda pentru a depesta care tip de filtrare se foloseste pe serverul nostru. Daca incarcam un fisier cu o extensie `.invalidfileextension` si acesta este incarcat atunci sunt folosite filtre de tip `BlackList` daca acesta nu este posibil atunci se foloseste filtre de tip `WhiteList`.

